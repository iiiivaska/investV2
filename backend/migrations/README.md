# üóÑÔ∏è –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π

–≠—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ñ–∞–π–ª—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–æ–µ–∫—Ç–µ InvestV2.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
migrations/
‚îú‚îÄ‚îÄ alembic/                    # –û—Å–Ω–æ–≤–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è Alembic
‚îÇ   ‚îú‚îÄ‚îÄ versions/              # –§–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 6cde36e9a795_*.py  # –ü–µ—Ä–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (users table)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 1581fdc380d1_*.py  # –í—Ç–æ—Ä–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (phone field)
‚îÇ   ‚îú‚îÄ‚îÄ env.py                 # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è Alembic
‚îÇ   ‚îú‚îÄ‚îÄ README                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Alembic
‚îÇ   ‚îî‚îÄ‚îÄ script.py.mako        # –®–∞–±–ª–æ–Ω –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ alembic.ini               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
‚îú‚îÄ‚îÄ migrate.py                # –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
‚îú‚îÄ‚îÄ investv2.db              # SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
‚îú‚îÄ‚îÄ ALEMBIC_GUIDE.md         # –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏—è–º
‚îú‚îÄ‚îÄ ALEMBIC_EXAMPLES.md      # –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ README.md                # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
```bash
cd backend
source venv/bin/activate

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
python migrate.py status

# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
python migrate.py create "–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
python migrate.py upgrade

# –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
python migrate.py downgrade
```

### –ò–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ migrations:
```bash
cd backend/migrations
source ../venv/bin/activate

# –ü—Ä—è–º—ã–µ –∫–æ–º–∞–Ω–¥—ã Alembic
alembic current
alembic revision --autogenerate -m "–û–ø–∏—Å–∞–Ω–∏–µ"
alembic upgrade head
alembic downgrade -1
```

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

- ‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: SQLite (`investv2.db`)
- ‚úÖ **–¢–∞–±–ª–∏—Ü–∞ users**: –°–æ–∑–¥–∞–Ω–∞ —Å –ø–æ–ª—è–º–∏ id, email, hashed_password, first_name, last_name, is_active, is_verified, is_superuser, last_login, created_at, updated_at, phone
- ‚úÖ **–ú–∏–≥—Ä–∞—Ü–∏–∏**: 2 –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- ‚úÖ **–°—Ç–∞—Ç—É—Å**: –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞**: SQLite (`investv2.db`)
- **Production**: PostgreSQL (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `app/core/config.py`)

### –ü—É—Ç–∏
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: `alembic.ini` ‚Üí `script_location = %(here)s/alembic`
- **–ú–æ–¥–µ–ª–∏**: –ò–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∏–∑ `app/models/`
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∏**: –ü–æ–ª—É—á–∞—é—Ç—Å—è –∏–∑ `app/core/config.py`

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- üìñ [–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ](ALEMBIC_GUIDE.md)
- üéØ [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](ALEMBIC_EXAMPLES.md)
- üîó [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Alembic](https://alembic.sqlalchemy.org/)

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π:
1. –°–æ–∑–¥–∞–π—Ç–µ –º–æ–¥–µ–ª—å –≤ `app/models/`
2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ `app/models/__init__.py`
3. –î–æ–±–∞–≤—å—Ç–µ –∏–º–ø–æ—Ä—Ç –≤ `alembic/env.py`
4. –°–æ–∑–¥–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é: `python migrate.py create "Add new model"`

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π:
1. –ò–∑–º–µ–Ω–∏—Ç–µ –º–æ–¥–µ–ª—å –≤ `app/models/`
2. –°–æ–∑–¥–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é: `python migrate.py create "Change model"`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é
4. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ: `python migrate.py upgrade`

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:
```bash
python migrate.py status
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä SQL –±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
```bash
cd migrations
alembic upgrade head --sql
```

### –°–±—Ä–æ—Å –º–∏–≥—Ä–∞—Ü–∏–π:
```bash
cd migrations
alembic stamp head
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ** —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
2. **–î–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø—ã** –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –º–∏–≥—Ä–∞—Ü–∏–π –≤ production
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏** –Ω–∞ –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö
4. **–ù–µ –∏–∑–º–µ–Ω—è–π—Ç–µ** —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏

---

**üéâ –ú–∏–≥—Ä–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**
